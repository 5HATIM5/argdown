<!DOCTYPE html>
    <head>
        <meta charset="utf-8">
        <meta content='IE=8' http-equiv='X-UA-Compatible'>
        <title>Argdown Test</title>
        <meta name="viewport" content="width=device-width">
<script src="http://code.jquery.com/jquery-1.11.0.min.js"></script>        
    </head>
    <body>
    <div class="left" style="position:absolute; height:100%; width:50%; padding:1em; -webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; ">
   <h3>Parser Input:</h3>

    <form name="argdownForm" style="height:80%;" onsubmit="return climbAst()" >
    <!--
    <div contenteditable="true" style="width: 100%; height: 90%; font-size:18px;" id="argdownTextarea">Argdown is great!
   +because It's so easy!</div><br/>
   -->
   <textarea style="width: 100%; height: 90%; font-size:18px;" id="argdownTextarea">Argdown is great!
   +because It's so easy!</textarea>
<input type="submit" name="Submit" value="Parse Argdown"/>
   </form>
   </div>
   <div style="position:absolute; height:100%; width:50%; left:50%; padding:1em; -webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box;" class="right">
   <h3>Parser Output (AST):</h3>
   <div id="output" style="background-color:#eee; border:1px solid #ccc; padding:1em;"></div>
   <p id="valid"></p>
   <h3>Lexer Output (Terminals):</h3>
   <ul id="terminals"></ul>
   </div>
        <script src="dist/ArgdownParser.js"></script>
        <script>

            var oldLex = ArgdownParser.lexer.lex;
            var terminals = "";
            ArgdownParser.lexer.lex = function(){
                var ret = oldLex.call(this);
                terminals +="<li>"+ArgdownParser.terminals_[ret]+"</li>";
                return ret;
            };
            ArgdownParser.trace = function(str){
                console.log(str);
            }

            var oldPerformAction = ArgdownParser.performAction;
            ArgdownParser.performAction = function anonymous(yytext,yyleng,yylineno,yy,yystate,$$,_$) {
                var ret = oldPerformAction.call(this, yytext, yyleng, yylineno, yy, yystate, $$, _$);
                console.log($$);
                return ret;
            }            


            var climb = function(node, indent){
                var output = "";
                var txt = (node.text)? "'"+node.text+"'" : "";
                output = indent+"> "+node.name+" "+txt+"\n";
                if(node.children){
                    for(var i = 0; i < node.children.length; i++){
                        output += climb(node.children[i], indent+"-");
                    }
                }
                return output;
            };
            var climbAst = function(){
                var indent = "";
                terminals = "";
                var str = document.getElementById("argdownTextarea").value;
                //var str = $("#argdownTextarea").text().replace("\xa0"," ");
                var output = "";
                if(str){
                    try{
                        var ast = ArgdownParser.parse(str); //ArgdownParser is a global object
                        for(var i = 0; i < ast.length; i++){
                            output += climb(ast[i],indent);
                        };                    
                        document.getElementById("output").innerHTML = "<pre>"+output+"</pre>";
                        var valid= "<span style='color:green;'>Valid Argdown</span>";
                        if(ArgdownParser.yy.errors){
                            valid = "<span style='color:red;'>Invalid Argdown</span>";
                        }
                        document.getElementById("valid").innerHTML = valid;
                        document.getElementById("terminals").innerHTML = terminals;
                    }catch(e){
                        console.error(e);
                    }
                }
                return false;
            };
        </script>
                
    </body>
    </html>